# Test Scripts

Simple test scripts for the medical data analysis agent system.

## Available Tests

### test_planner.py
Tests the **Conversational Planning Agent** - creates and edits structured execution plans through natural conversation.

**What it tests:**
- Natural language understanding for planning requests
- Chain-of-thought reasoning to decide when to generate plans
- Plan generation with medical data tools
- **Plan editing and iterative refinement**
- **Multiple sequential edits to existing plans**
- Conversational responses vs. structured plans

**Usage:**
```bash
# Interactive mode (default)
python test_planner.py

# Run full test suite (generation + editing + multi-edit)
python test_planner.py --full-test

# Test editing only with sample plan
python test_planner.py --edit-only
```

**Test Modes:**

1. **Interactive Mode** (default):
   - Choose between plan generation, editing, or conversation
   - Provide custom prompts and edit requests
   - Test specific scenarios manually

2. **Full Test Suite** (`--full-test`):
   - Generates an initial plan for mental health analysis
   - Edits the plan to add diagnosis checking
   - Performs multiple sequential edits (remove/add steps)
   - Shows progression of plan versions (v1 → v2 → v3)

3. **Edit-Only Mode** (`--edit-only`):
   - Uses a pre-defined sample plan
   - Tests the editing functionality in isolation
   - Useful for quick edit testing without generation

**Default behavior:**
- Uses placeholder values (MRN=0, CSN=0) for planning phase
- Supports plan versioning (plan_v1, plan_v2, etc.)
- Returns structured plan with steps, tools, and descriptions
- Tracks changes across edit iterations

---

### test_cot.py
Tests the **Chain-of-Thought Supervisor** - coordinates multiple worker agents for complex tasks.

**What it tests:**
- Task decomposition and sub-task planning
- Multi-agent coordination
- Worker agent orchestration
- Result synthesis

**Usage:**
```bash
# With custom prompt
python test_cot.py --prompt "Analyze patient vitals and medications"

# With default prompt
python test_cot.py
```

**Default behavior:**
- Uses supervisor agent to break down complex requests
- Coordinates worker agents for execution
- Returns synthesized results

---

### test_process.py
Tests the **Plan Execution Engine** - executes structured plans generated by the planning agent.

**What it tests:**
- Sequential step execution
- Variable resolution ({{variable}} references)
- Tool execution and result storage
- Error handling and dependency management

**Usage:**
```bash
python test_process.py
```

**Default behavior:**
- Loads a test plan with predefined steps
- Executes tools with actual medical data
- Manages execution context and variables
- Returns execution results and any errors

---

## Test Workflow

Typical workflow combining these tests:

1. **Planning** (`test_planner.py`):
   ```bash
   python test_planner.py
   ```
   → Generates structured plan

2. **Execution** (`test_process.py`):
   ```bash
   python test_process.py
   ```
   → Executes the plan against real/test data

3. **Complex Tasks** (`test_cot.py`):
   ```bash
   python test_cot.py --prompt "Your complex analysis request"
   ```
   → Handles multi-step analysis with coordination

---

## Directory Structure

```
tester_codes/
├── README.md           # This file
├── test_planner.py     # Planning agent tests
├── test_cot.py         # Supervisor agent tests
└── test_process.py     # Execution engine tests
```

---

## Notes

- All tests use `sys.path.append('../')` to import from backend modules
- Tests use default/placeholder values when not specified
- For production use, pass actual MRN/CSN values via API endpoints
- Tests are designed for quick manual verification, not automated CI/CD

---

## Quick Reference

| Test | Agent | Purpose | Input |
|------|-------|---------|-------|
| `test_planner.py` | Planning | Generate plans | Natural language |
| `test_cot.py` | Supervisor | Coordinate tasks | Complex requests |
| `test_process.py` | Executor | Run plans | Structured plans |
